<div class="results-container">
  <h1>Your Rankings</h1>

  <mat-card class="stats-card" *ngIf="animeList.length > 0">
    <mat-card-content>
      <div class="stats">
        <div class="stat">
          <span class="value">{{ animeList.length }}</span>
          <span class="label">Anime Ranked</span>
        </div>
        <div class="stat">
          <span class="value">{{ averageRating | number:'1.1-1' }}</span>
          <span class="label">Average Rating</span>
        </div>
        <div class="stat">
          <span class="value">{{ topAnime?.title || '-' }}</span>
          <span class="label">Top Rated</span>
        </div>
      </div>
    </mat-card-content>
  </mat-card>

  <mat-card class="table-card">
    <mat-card-header>
      <mat-card-title>Ranked List</mat-card-title>
      <div class="actions">
        <button mat-button (click)="exportJson()">
          <mat-icon>download</mat-icon>
          Export JSON
        </button>
        <button mat-raised-button color="primary" (click)="startNewRanking()">
          <mat-icon>refresh</mat-icon>
          New Ranking
        </button>
      </div>
    </mat-card-header>
    <mat-card-content>
      <table mat-table [dataSource]="dataSource" matSort class="anime-table">
        <ng-container matColumnDef="rank">
          <th mat-header-cell *matHeaderCellDef mat-sort-header>Rank</th>
          <td mat-cell *matCellDef="let anime; let i = index">{{ i + 1 }}</td>
        </ng-container>

        <ng-container matColumnDef="image">
          <th mat-header-cell *matHeaderCellDef></th>
          <td mat-cell *matCellDef="let anime">
            <img [src]="anime.main_picture.medium" [alt]="anime.title" class="anime-thumb">
          </td>
        </ng-container>

        <ng-container matColumnDef="title">
          <th mat-header-cell *matHeaderCellDef mat-sort-header>Title</th>
          <td mat-cell *matCellDef="let anime" class="title-cell">{{ anime.title }}</td>
        </ng-container>

        <ng-container matColumnDef="rating">
          <th mat-header-cell *matHeaderCellDef mat-sort-header>Rating</th>
          <td mat-cell *matCellDef="let anime">
            <span class="rating-badge" [class.high]="anime.rating >= 8" [class.low]="anime.rating <= 5">
              {{ anime.rating | number:'1.1-1' }}
            </span>
          </td>
        </ng-container>

        <ng-container matColumnDef="elo">
          <th mat-header-cell *matHeaderCellDef mat-sort-header>Elo</th>
          <td mat-cell *matCellDef="let anime">{{ anime.elo | number:'1.0-0' }}</td>
        </ng-container>

        <ng-container matColumnDef="comparisons">
          <th mat-header-cell *matHeaderCellDef mat-sort-header>Comparisons</th>
          <td mat-cell *matCellDef="let anime">{{ anime.comparisons || 0 }}</td>
        </ng-container>

        <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
        <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
      </table>
      <mat-paginator [pageSizeOptions]="[10, 25, 50, 100]" showFirstLastButtons></mat-paginator>
    </mat-card-content>
  </mat-card>
</div>
